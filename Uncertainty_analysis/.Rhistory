allometries[["pinus.sp"]] <- mc[[3]][sample(which(mc[[3]][,"mu1"]>=0), size=500, replace=T),]
summary(allometries)
summary(allometries$pinus.sp)
# loading in general fir pecan mcmc runs
load("/Users/mrossalexander/Desktop/PEcAn_Allometries/Ross_allometries/Allom.abies.sp.2.Rdata")
allometries[["abies.sp"]] <- mc[[3]][sample(which(mc[[3]][,"mu1"]>=0), size=500, replace=T),]
summary(allometries)
summary(allometries$abies.sp)
g.filled.diam <- read.csv("gap_filled_dbh.recon.csv", header=T, row.names=1)
g.filled.diam <- g.filled.diam[,substr(names(g.filled.diam),1,1)=="V"]
summary(g.filled.diam)
# read in tree data
tree.data <- read.csv("TreeData.csv", header=T)
summary(tree.data)
#trees.use <- tree.data[substr(tree.data$PlotID, 1, 1)=="V" | substr(tree.data$PlotID, 1, 2)=="MM",]
trees.use <- tree.data[substr(tree.data$PlotID, 1, 1)=="V",]
summary(trees.use)
#quick plot
spag.plot(g.filled.diam)
plot.data <- read.csv("raw input files/DOE_plus_Valles.csv")
summary(plot.data)
##########################################################################
# Allometric Equations
##########################################################################
#Convert to biomass with the allometric equation
#using the PECAN generated bayesian equations
library(car)
# Getting rid of POTR for now for conceptual figure purposes
trees.use <- trees.use[!(trees.use$Species=="POTR"),]
summary(trees.use)
unique(trees.use$Species)
trees.use$spp.allom <- recode(trees.use$Species, " 'PIEN'='picea.sp'; 'PIPO'='pipo'; 'PSME'='psme'")
summary(trees.use)
plots <- unique(trees.use$PlotID) # You had the right idea, but it was throwing errors because you were trying to evaluate plots you haven't gotten to yet
# will want to do general equations and pft level equations as well, but later
# log(AGB) = mu0 + mu1*log(DBH) --equaton form of PECAN allometrics
#allom.eq <- function(mu0, mu1, DBH) { mu0 * DBH^mu1}
allom.eq <- function(mu0, mu1, DBH) { exp(mu0 + mu1 * log(DBH) )}
# dbh <- 1:50
# test <- allom.eq(mu0= -3.5185,
#                  mu1 = 2.6909,
#                  DBH = dbh)
#
# plot(test*.09 ~ dbh)
allom.temp <- g.filled.diam
allom.temp[,] <- NA
# dbh=0 causes problems, so we're going to make those NA
g.filled.diam[g.filled.diam==0] <- 1e-6
min(g.filled.diam, na.rm=T)
summary(g.filled.diam)
dim(g.filled.diam)
bm.array <- array(NA, dim=c(nrow(g.filled.diam), length(unique(trees.use$PlotID)), nrow(allometries[[1]])))
row.names(bm.array) <- row.names(g.filled.diam)  #CRR Added
summary(bm.array[,,1])
#--------------------------------------------------
# INSERT i LOOP HERE to go through each iteration of randomness from MCMC
# This is one big loop that goes through each layer of the 500 iterations
#--------------------------------------------------
for(i in 1:nrow(allometries[[1]])){
allom.temp <- g.filled.diam
allom.temp[,] <- NA
# Species loop for calculating tree biomass
for(j in unique(trees.use$spp.allom)){
cols <- which(names(g.filled.diam) %in% trees.use[trees.use$spp.allom==j, "TreeID"])
# Note: we'll have to make this a bit fancier in the future for species with mu0==0
#   allom.temp[,cols] <- allom.eq(mu0= -3.5185,
#                          mu1 = 2.6909,
#                         #DBH = seq(from=30, to=1, length=nrow(g.filled.diam)))
#                          DBH = g.filled.diam[,cols])
# test <- allom.eq(mu0=ifelse(!(allometries[[j]][i,"mu0"]==0 & allometries[[j]][i,"mu1"]==0),allometries[[j]][i,"mu0"], allometries[[j]][i,"Bg0"]),
#                               mu1 =ifelse(!(allometries[[j]][i,"mu0"]==0 & allometries[[j]][i,"mu1"]==0),allometries[[j]][i,"mu1"], allometries[[j]][i,"Bg1"]),
#                               DBH = g.filled.diam[,cols])
mu0 = ifelse(!(allometries[[j]][i,"mu0"]==0 & allometries[[j]][i,"mu1"]==0),allometries[[j]][i,"mu0"], allometries[[j]][i,"Bg0"])
mu1 = ifelse(!(allometries[[j]][i,"mu0"]==0 & allometries[[j]][i,"mu1"]==0),allometries[[j]][i,"mu1"], allometries[[j]][i,"Bg1"])
allom.temp[,cols] <- allom.eq(mu0=mu0, mu1 = mu1, DBH = g.filled.diam[,cols])
}
# summing to the plot level
allom.temp[is.na(allom.temp)] <- 0
# biomass loop for summing trees to plots
# We're doing the unit conversions here; we had calculated density in stems/ha, but Christy wants to look at Biomass in kg/m2, so we're putting everything in kg/m2 here
for(p in 1:length(plots)){
cols <- which(names(allom.temp) %in% trees.use[trees.use$PlotID==plots[p], "TreeID"])
if(substr(plots[p],1,1)=="V"){
bm.array[,p,i] <- rowMeans(allom.temp[,cols])*plot.data[plot.data$PlotID==paste(plots[p]), "Density.Total..stems.ha."]/10000 #mean tree * trees/ha (do for Valles only bc sum of trees != plot density; different sampling method than Neil)
} else {
temp <- allom.temp[,cols]
for(t in names(temp)){ # Convert biomass/tree to biomass/ha
temp[,t] <- temp[,t] * tree.data[tree.data$TreeID==t,"Density..stems.ha."]/10000
}
bm.array[,p,i] <- rowSums(temp) #sum biomass/ha
}
}
}
#--------------------------------------------------
#bm.array[,,1]
summary(bm.array[,,1])
# OFFENDER: VUF032; VUF026 is good
g.filled.diam[,c("VUF026","VUF032")]
### OUTSIDE of all LOOPs (iteration + species + plots)
# You should now have a 3-dimensional array with plots as columns, years as rows, and iterations as layers
biom.mean <- apply(bm.array[,,], c(1,2), mean) # bm.array==the array you're working with, 3 = do the funciton to the layers (3rd dim), mean = the function you're running
biom.sd <- apply(bm.array[,,], c(1,2), sd) # bm.array==the array you're working with, 3 = do the funciton to the layers (3rd dim), mean = the function you're running
biom.se <- apply(bm.array[,,], c(1,2), se)
biom.mean <- as.data.frame(biom.mean)
names(biom.mean)<- plots
biom.sd <-as.data.frame(biom.sd)
names(biom.sd)<- c(paste(plots, "sd", sep="."))
biom.se <-as.data.frame(biom.se)
names(biom.se)<- c(paste(plots, "se", sep="."))
biom.valles <- as.data.frame(c(biom.mean, biom.sd, biom.se))
row.names(biom.valles) <- row.names(biom.mean)
summary(biom.valles)
head(biom.valles)
#save(biom.valles, file="biom.valles_cum.csv")
#---------------------------------------------------------------------
# This we did in a loop above to make it mroe flexible for the future
# (and we did it right this time)
#---------------------------------------------------------------------
# biom.valles.cum.dens <- biom.valles
#
# biom.valles.cum.dens$VLA <- biom.valles.cum.dens$VLA / 144/1000
# biom.valles.cum.dens$VLA.sd <- biom.valles.cum.dens$VLA.sd /144/1000
# biom.valles.cum.dens$VLA.se <- biom.valles.cum.dens$VLA.se /144/1000
#
# biom.valles.cum.dens$VLB <- biom.valles.cum.dens$VLB /624/1000
# biom.valles.cum.dens$VLB.sd <- biom.valles.cum.dens$VLB.sd /624/1000
# biom.valles.cum.dens$VLB.se <- biom.valles.cum.dens$VLB.se /624/1000
#
# biom.valles.cum.dens$VUA <- biom.valles.cum.dens$VUA /576/1000
# biom.valles.cum.dens$VUA.sd <- biom.valles.cum.dens$VUA.sd /576/1000
# biom.valles.cum.dens$VUA.se <- biom.valles.cum.dens$VUA.se /576/1000
#
# biom.valles.cum.dens$VUB <- biom.valles.cum.dens$VUB /576/1000
# biom.valles.cum.dens$VUB.sd <- biom.valles.cum.dens$VUB.sd /576/1000
# biom.valles.cum.dens$VUB.se <- biom.valles.cum.dens$VUB.se /576/1000
#
# summary(biom.valles.cum.dens)
# biom.valles.cum.dens$year <- as.factor(row.names(biom.valles.cum.dens))
# head(biom.valles.cum.dens)
# now we have biomass per m^2 for each plot with SD
#---------------------------------------------------------------------
#save(biom.valles.cum.dens, file="biom_valles_dum_m2.csv")
biom.valles.stack <- stack(biom.valles[1:4])
names(biom.valles.stack) <- c("Biom.Mean", "PlotID")
biom.valles.stack$Year <- as.numeric(paste(row.names(biom.valles)))
biom.valles.stack$Plot <- as.factor(substr(biom.valles.stack$PlotID, 3,3))
biom.valles.stack$Site <- as.factor(substr(biom.valles.stack$PlotID, 1,2))
summary(biom.valles.stack)
biom.valles.stack.sd <- stack(biom.valles[5:8])
names(biom.valles.stack.sd) <- c("Biom.SD", "PlotID")
biom.valles.stack.se <- stack(biom.valles[9:12])
names(biom.valles.stack.se) <- c("Biom.SE", "PlotID")
biom.valles.stack$Biom.SD <- biom.valles.stack.sd[,1]
biom.valles.stack$Biom.SE <- biom.valles.stack.se[,1]
summary(biom.valles.stack)
biom.valles.stack$Ribbon.max <- biom.valles.stack$Biom.Mean + biom.valles.stack$Biom.SD
biom.valles.stack$Ribbon.min <- biom.valles.stack$Biom.Mean - biom.valles.stack$Biom.SD
# biom.valles.stack$Ribbon.min <- ifelse(biom.valles.stack$Ribbon.min < 0, 0, biom.valles.stack$Ribbon.min)
# biom.valles.stack$Ribbon.max <- ifelse(biom.valles.stack$Ribbon.max > 100, 100, biom.valles.stack$Ribbon.max)
summary(biom.valles.stack)
ggplot(data=biom.valles.stack[biom.valles.stack$Year<2012 & (biom.valles.stack$Site=="VL"),])  + facet_grid(Plot ~ Site) +
# plotting total site basal area
geom_ribbon(aes(x=Year, ymin=Biom.Mean-Biom.SD, ymax=Biom.Mean+Biom.SD, fill=PlotID), alpha=0.5) +
geom_line(aes(x=Year, y=Biom.Mean, color=PlotID))
ggplot(data=biom.valles.stack[biom.valles.stack$Year<2012,])  + facet_grid(Plot ~ Site) +
# plotting total site basal area
geom_ribbon(aes(x=Year, ymin=Ribbon.min, ymax=Ribbon.max, fill=PlotID), alpha=0.5) +
geom_line(aes(x=Year, y=Biom.Mean, color=PlotID)) +
scale_y_continuous(limits=c(0,1000)) #+
ggplot(data=biom.valles.stack[biom.valles.stack$Year<2012,])  + facet_grid(Plot ~ Site) +
# plotting total site basal area
geom_ribbon(aes(x=Year, ymin=Ribbon.min, ymax=Ribbon.max, fill=PlotID), alpha=0.5) +
geom_line(aes(x=Year, y=Biom.Mean, color=PlotID)) +
ggplot(data=biom.valles.stack[biom.valles.stack$Year<2012,])  + facet_grid(Plot ~ Site) +
# plotting total site basal area
geom_ribbon(aes(x=Year, ymin=Ribbon.min, ymax=Ribbon.max, fill=PlotID), alpha=0.5) +
geom_line(aes(x=Year, y=Biom.Mean, color=PlotID))
library(ggplot2)
# exploratory analysis of Marcy Litvak's Valles Caldera Data
marcy.pipo <- read.csv("raw input files/marcy_ppine_2013.csv", header=T)
marcy.mcon <- read.csv("raw input files/marcy_mcon_2012.csv", header=T)
ross.trees <- read.csv("raw input files/tree_metadata_DOE_plus_valles.csv", na.strings=c("", "NA", "#VALUE!", "*"),header=T)
# subsetting only the valles trees from the overall trees list
summary(ross.trees)
ross.valles <- ross.trees[substr(ross.trees$PlotID,1,1)=="V",]
summary(ross.valles)
# reducing the number of columns in the data frame
ross.valles<- ross.valles[,c("TreeID", "PlotID", "Species","DBH..cm.", "Density..stems.ha.")]
names(ross.valles)<- c("tree.id", "plot.id", "species", "dbh", "density")
summary(ross.valles)
# settign site as a factor
ross.valles$site<- as.factor(substr(ross.valles$plot.id, 1, 2))
summary(ross.valles)
ross.pipo <- ross.valles[substr(ross.valles$plot.id,1,2)=="VL",]
ross.mcon <- ross.valles[substr(ross.valles$plot.id,1,2)=="VU",]
summary(ross.pipo)
summary(ross.mcon)
# Calculating density per plot for Marcy's data; she used 10m plots
summary(marcy.pipo)
marcy.pipo$density <- 1/(pi*marcy.pipo$Plot_Radius^2)/1e-4
summary(marcy.pipo)
marcy.mcon$density <- 1/(pi*marcy.mcon$Plot_Radius^2)/1e-4
summary(marcy.mcon)
#now density is in trees per hectare to match what christy calculated in the DOE spreadsheets.
marcy.valles<- merge(marcy.pipo, marcy.mcon, all.x=T, all.y=T)
summary(marcy.valles)
marcy.valles <- marcy.valles[,c("Site","Plot_Name", "Tree_Tag_Number","Species", "DBH_1", "density")]
summary(marcy.valles)
names(marcy.valles)<- c("site", "plot.id", "tree.id", "species", "dbh", "density")
summary(marcy.valles)
all.valles<-merge(marcy.valles, ross.valles, all.x=T, all.y=T)
summary(all.valles)
all.valles$site<- ifelse(substr(all.valles$site, 1, 2)=="VL", "ppine.ross",
ifelse(substr(all.valles$site,1,2)=="VU", "mcon.ross",
ifelse(all.valles$site=="PPINE", "ppine.marcy", "mcon.marcy")))
all.valles$site<-as.factor(all.valles$site)
summary(all.valles)
dbh.bins1 <- seq(0, max(all.valles$dbh, na.rm=T), 2)
qplot(x=dbh, data=all.valles, geom="histogram", breaks=dbh.bins1, fill=species)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems") + ggtitle("Size Distribution") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=all.valles, geom="histogram", breaks=dbh.bins1, fill=species, weight=density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=all.valles, geom="histogram", breaks=dbh.bins1, fill=species, weight=density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
# -----------------------
# Ignoring species for a minute
valles.plot <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id), FUN=sum, na.rm=T)
names(valles.plot) <- c("site", "plot.id", "density")
valles.plot
valles.site <- aggregate(valles.plot$density, by=list(valles.plot$site), FUN=mean)
names(valles.site) <- c("site", "density")
valles.site
ggplot()+
geom_histogram(data=valles.site, aes(x=site, weight=density, fill=site)) +
geom_histogram(data=valles.plot[valles.plot$plot.id=="VLB",], aes(x=site, weight=density))+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_discrete(name="Site")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density; VLB overlay in black") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
# -----------------------
all.valles$dbh.2 <- round(all.valles$dbh)
summary(all.valles)
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh2, FUN=sum, na.rm=T)
names(valles.plot2) <- c("site", "plot.id", "species", "dbh", "density")
summary(valles.plot2)
valles.site2 <- aggregate(valles.plot2$density, by=list(valles.plot2$site, valles.plot2$species, valles.plot2$dbh), FUN=mean)
names(valles.site2) <- c("site", "species", "dbh", "density")
summary(valles.site2)
qplot(x=dbh, data=valles.site2, geom="histogram", breaks=dbh.bins1, fill=species, weight=density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
summary(valles.site2)
qplot(x=dbh, data=valles.site2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
test <- t.test(marcy.pipo$DBH_1, ross.pipo$dbh, na.rm=T)
summary(test)
test
summary(marcy.pipo)
marcy.pipo <- read.csv("raw input files/marcy_ppine_2013.csv", header=T)
marcy.mcon <- read.csv("raw input files/marcy_mcon_2012.csv", header=T)
ross.trees <- read.csv("raw input files/tree_metadata_DOE_plus_valles.csv", na.strings=c("", "NA", "#VALUE!", "*"),header=T)
summary(ross.trees)
ross.valles <- ross.trees[substr(ross.trees$PlotID,1,1)=="V",]
summary(ross.valles)
ross.valles<- ross.valles[,c("TreeID", "PlotID", "Species","DBH..cm.", "Density..stems.ha.")]
names(ross.valles)<- c("tree.id", "plot.id", "species", "dbh", "density")
summary(ross.valles)
ross.valles$site<- as.factor(substr(ross.valles$plot.id, 1, 2))
summary(ross.valles)
ross.pipo <- ross.valles[substr(ross.valles$plot.id,1,2)=="VL",]
ross.mcon <- ross.valles[substr(ross.valles$plot.id,1,2)=="VU",]
summary(ross.pipo)
summary(ross.mcon)
summary(marcy.pipo)
marcy.pipo$plot <- paste(marcy.pipo$Site, marcy.pipo$Plot_Name, sep="")
summary(marcy.pipo)
marcy.pipo$plot <- as.factorpaste(marcy.pipo$Site, marcy.pipo$Plot_Name, sep="")
marcy.pipo$plot <- as.factor(paste(marcy.pipo$Site, marcy.pipo$Plot_Name, sep=""))
summary(marcy.pipo)
marcy.mcon$density <- 1/(pi*marcy.mcon$Plot_Radius^2)/1e-4
marcy.mcon$plot <- as.factor(paste(marcy.mcon$Site, marcy.mcon$Plot_Name, sep=""))
summary(marcy.mcon)
marcy.valles<- merge(marcy.pipo, marcy.mcon, all.x=T, all.y=T)
summary(marcy.valles)
marcy.valles <- marcy.valles[,c("Site","Plot_Name", "Tree_Tag_Number","Species", "DBH_1", "density")]
summary(marcy.valles)
names(marcy.valles)<- c("site", "plot.id", "tree.id", "species", "dbh", "density")
summary(marcy.valles)
marcy.valles <- marcy.valles[,c("Site", "Tree_Tag_Number","Species", "DBH_1", "density", "plot")]
marcy.valles<- merge(marcy.pipo, marcy.mcon, all.x=T, all.y=T)
summary(marcy.valles)
marcy.valles <- marcy.valles[,c("Site", "Tree_Tag_Number","Species", "DBH_1", "density", "plot")]
summary(marcy.valles)
names(marcy.valles)<- c("site", "tree.id", "species", "dbh", "density", "plot.id")
summary(marcy.valles)
all.valles<-merge(marcy.valles, ross.valles, all.x=T, all.y=T)
summary(all.valles)
all.valles$site<- ifelse(substr(all.valles$site, 1, 2)=="VL", "ppine.ross",
ifelse(substr(all.valles$site,1,2)=="VU", "mcon.ross",
ifelse(all.valles$site=="PPINE", "ppine.marcy", "mcon.marcy")))
all.valles$site<-as.factor(all.valles$site)
summary(all.valles)
dbh.bins1 <- seq(0, max(all.valles$dbh, na.rm=T), 2)
qplot(x=dbh, data=all.valles, geom="histogram", breaks=dbh.bins1, fill=species)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems") + ggtitle("Size Distribution") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=all.valles, geom="histogram", breaks=dbh.bins1, fill=species, weight=density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=all.valles, geom="histogram", breaks=dbh.bins1, fill=species, weight=density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
valles.plot <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id), FUN=sum, na.rm=T)
names(valles.plot) <- c("site", "plot.id", "density")
valles.plot
valles.site <- aggregate(valles.plot$density, by=list(valles.plot$site), FUN=mean)
names(valles.site) <- c("site", "density")
valles.site
geom_histogram(data=valles.site, aes(x=site, weight=density, fill=site)) +
geom_histogram(data=valles.plot[valles.plot$plot.id=="VLB",], aes(x=site, weight=density))+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_discrete(name="Site")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density; VLB overlay in black") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
ggplot()+
geom_histogram(data=valles.site, aes(x=site, weight=density, fill=site)) +
geom_histogram(data=valles.plot[valles.plot$plot.id=="VLB",], aes(x=site, weight=density))+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_discrete(name="Site")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density; VLB overlay in black") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
all.valles$dbh.2 <- round(all.valles$dbh)
summary(all.valles)
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh2, FUN=sum, na.rm=T)
names(valles.plot2) <- c("site", "plot.id", "species", "dbh", "density")
summary(valles.plot2)
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh2, FUN=sum, na.rm=T)
names(valles.plot2) <- c("site", "plot.id", "species", "dbh", "density")
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh2, FUN=sum, na.rm=T))
names(valles.plot2) <- c("site", "plot.id", "species", "dbh", "density")
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh2, FUN=sum, na.rm=T))
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh2, FUN=Sum, na.rm=T))
summary(all.valles)
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh2, FUN=sum, na.rm=T))
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh2), FUN=sum, na.rm=T)
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh.2), FUN=sum, na.rm=T)
names(valles.plot2) <- c("site", "plot.id", "species", "dbh", "density")
summary(valles.plot2)
valles.site2 <- aggregate(valles.plot2$density, by=list(valles.plot2$site, valles.plot2$species, valles.plot2$dbh), FUN=mean)
names(valles.site2) <- c("site", "species", "dbh", "density")
summary(valles.site2)
qplot(x=dbh, data=valles.site2, geom="histogram", breaks=dbh.bins1, fill=species, weight=density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
summary(valles.site2)
qplot(x=dbh, data=valles.site2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=valles.site2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
library(ggplot2)
# exploratory analysis of Marcy Litvak's Valles Caldera Data
marcy.pipo <- read.csv("raw input files/marcy_ppine_2013.csv", header=T)
marcy.mcon <- read.csv("raw input files/marcy_mcon_2012.csv", header=T)
ross.trees <- read.csv("raw input files/tree_metadata_DOE_plus_valles.csv", na.strings=c("", "NA", "#VALUE!", "*"),header=T)
# subsetting only the valles trees from the overall trees list
summary(ross.trees)
ross.valles <- ross.trees[substr(ross.trees$PlotID,1,1)=="V",]
summary(ross.valles)
# reducing the number of columns in the data frame
ross.valles<- ross.valles[,c("TreeID", "PlotID", "Species","DBH..cm.", "Density..stems.ha.")]
names(ross.valles)<- c("tree.id", "plot.id", "species", "dbh", "density")
summary(ross.valles)
# settign site as a factor
ross.valles$site<- as.factor(substr(ross.valles$plot.id, 1, 2))
summary(ross.valles)
ross.pipo <- ross.valles[substr(ross.valles$plot.id,1,2)=="VL",]
ross.mcon <- ross.valles[substr(ross.valles$plot.id,1,2)=="VU",]
summary(ross.pipo)
summary(ross.mcon)
# Calculating density per plot for Marcy's data; she used 10m plots
summary(marcy.pipo)
marcy.pipo$density <- 1/(pi*marcy.pipo$Plot_Radius^2)/1e-4
marcy.pipo$plot <- as.factor(paste(marcy.pipo$Site, marcy.pipo$Plot_Name, sep=""))
summary(marcy.pipo)
marcy.mcon$density <- 1/(pi*marcy.mcon$Plot_Radius^2)/1e-4
marcy.mcon$plot <- as.factor(paste(marcy.mcon$Site, marcy.mcon$Plot_Name, sep=""))
summary(marcy.mcon)
#now density is in trees per hectare to match what christy calculated in the DOE spreadsheets.
marcy.valles<- merge(marcy.pipo, marcy.mcon, all.x=T, all.y=T)
summary(marcy.valles)
marcy.valles <- marcy.valles[,c("Site", "Tree_Tag_Number","Species", "DBH_1", "density", "plot")]
summary(marcy.valles)
names(marcy.valles)<- c("site", "tree.id", "species", "dbh", "density", "plot.id")
summary(marcy.valles)
all.valles<-merge(marcy.valles, ross.valles, all.x=T, all.y=T)
summary(all.valles)
all.valles$site<- ifelse(substr(all.valles$site, 1, 2)=="VL", "ppine.ross",
ifelse(substr(all.valles$site,1,2)=="VU", "mcon.ross",
ifelse(all.valles$site=="PPINE", "ppine.marcy", "mcon.marcy")))
all.valles$site<-as.factor(all.valles$site)
summary(all.valles)
dbh.bins1 <- seq(0, max(all.valles$dbh, na.rm=T), 2)
qplot(x=dbh, data=all.valles, geom="histogram", breaks=dbh.bins1, fill=species)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems") + ggtitle("Size Distribution") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=all.valles, geom="histogram", breaks=dbh.bins1, fill=species, weight=density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=all.valles, geom="histogram", breaks=dbh.bins1, fill=species, weight=density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
# -----------------------
# Ignoring species for a minute
valles.plot <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id), FUN=sum, na.rm=T)
names(valles.plot) <- c("site", "plot.id", "density")
valles.plot
valles.site <- aggregate(valles.plot$density, by=list(valles.plot$site), FUN=mean)
names(valles.site) <- c("site", "density")
valles.site
ggplot()+
geom_histogram(data=valles.site, aes(x=site, weight=density, fill=site)) +
geom_histogram(data=valles.plot[valles.plot$plot.id=="VLB",], aes(x=site, weight=density))+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_discrete(name="Site")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density; VLB overlay in black") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
# -----------------------
all.valles$dbh.2 <- round(all.valles$dbh)
summary(all.valles)
valles.plot2 <- aggregate(all.valles$density, by=list(all.valles$site, all.valles$plot.id, all.valles$species, all.valles$dbh.2), FUN=sum, na.rm=T)
names(valles.plot2) <- c("site", "plot.id", "species", "dbh", "density")
summary(valles.plot2)
valles.site2 <- aggregate(valles.plot2$density, by=list(valles.plot2$site, valles.plot2$species, valles.plot2$dbh), FUN=mean)
names(valles.site2) <- c("site", "species", "dbh", "density")
summary(valles.site2)
qplot(x=dbh, data=valles.site2, geom="histogram", breaks=dbh.bins1, fill=species, weight=density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
summary(valles.site2)
qplot(x=dbh, data=valles.site2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
test <- t.test(marcy.pipo$DBH_1, ross.pipo$dbh, na.rm=T)
summary(test)
test
qplot(x=dbh, data=valles.plot2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(site ~ plot.id)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=valles.plot2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(plot.id ~ site)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
summary(valles.site2)
qplot(x=dbh, data=valles.site2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(site ~ .)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=valles.plot2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(site ~ plot.id)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
summary(valles.site2)
valles.site2$site2 <- if(substr(valles.stie2$site,1,4)=="mcon", "mcon", "ppine")
valles.site2$site2 <- ifelse(substr(valles.stie2$site,1,4)=="mcon", "mcon", "ppine")
valles.site2$site2 <- ifelse(substr(valles.site2$site,1,4)=="mcon", "mcon", "ppine")
summary(valles.site2)
valles.site2$site2 <- as.factor(ifelse(substr(valles.site2$site,1,4)=="mcon", "mcon", "ppine"))
summary(valles.site2)
valles.plot2$site2 <- as.factor(ifelse(substr(valles.plot2$site,1,4)=="mcon", "mcon", "ppine"))
summary(valles.plot2)
library(car)
summary(valles.plot2)
levels(valles.plot2$plot.id)
unique(valles.plot2$plot.id)
valles.plot2$plot.id2 <- ifelse(substr(valles.plot2$plot.id,1,5)=="PPINE", substr(valles.plot2$plot.id,6,6),
ifelse(substr(valles.plot2$plot.id,1,4)=="MCON", substr(valles.plot2$plot.id,5,5)
ifelse(substr(valles.plot2$plot.id,3,3)=="A",5, 6)))
valles.plot2$plot.id2 <- ifelse(substr(valles.plot2$plot.id,1,5)=="PPINE", substr(valles.plot2$plot.id,6,6),
ifelse(substr(valles.plot2$plot.id,1,4)=="MCON", substr(valles.plot2$plot.id,5,5),
ifelse(substr(valles.plot2$plot.id,3,3)=="A",5, 6)))
summary(valles.plot2)
valles.plot2$plot.id2 <- as.factor(ifelse(substr(valles.plot2$plot.id,1,5)=="PPINE", substr(valles.plot2$plot.id,6,6),
ifelse(substr(valles.plot2$plot.id,1,4)=="MCON", substr(valles.plot2$plot.id,5,5),
ifelse(substr(valles.plot2$plot.id,3,3)=="A",5, 6))))
summary(valles.plot2)
qplot(x=dbh, data=valles.plot2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(site2 ~ plot.id2)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
qplot(x=dbh, data=valles.plot2, geom="histogram", breaks=dbh.bins1, fill=species, weight=sum(density)/density)+
facet_grid(plot.id2 ~ site2)+
theme(axis.line=element_line(color="black", size=0.5), panel.grid.major=element_blank(), panel.grid.minor= element_blank(), panel.border= element_blank(), panel.background= element_blank(), axis.text.x=element_text(angle=0, color="black", size=12), axis.text.y=element_text(color="black", size=12)) +
scale_x_continuous(name="DBH")+scale_y_continuous(name="Stems/ha") + ggtitle("Size Distribution weighted by Density") #+ scale_fill_manual(values=as.vector(spp.col.tree$Color))
ggplot(data=biom.valles.stack[biom.valles.stack$Year<2012,])  + facet_grid(Plot ~ Site) +
# plotting total site basal area
geom_ribbon(aes(x=Year, ymin=Ribbon.min, ymax=Ribbon.max, fill=PlotID), alpha=0.5) +
geom_line(aes(x=Year, y=Biom.Mean, color=PlotID))
